<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lobby da Mesa</title>
    <link rel="icon" href="/images/icon.jpg" type="image/jpeg">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        @font-face {
            font-family: "Adobe Hebrew Regular";
            src: url("/fonts/adobe-hebrew-regular.otf") format("opentype");
        }
        body { font-family: "Adobe Hebrew Regular", Arial, sans-serif; background: #121212; color: #fff; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #e0e0e0; }
        .personagens-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .personagem-card { background: #1f1f1f; padding: 20px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.4); text-align: center; }
        .personagem-card .portrait { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #444; margin-bottom: 15px; }
        .personagem-card h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.4em; color: #27ae60; }
        .personagem-card a { display: block; padding: 12px; background: #3498db; color: #fff; text-decoration: none; border-radius: 6px; font-weight: bold; transition: background-color 0.3s; }
        .personagem-card a:hover { background: #2980b9; }
        .navigation-links { margin-top: 40px; display: flex; justify-content: center; gap: 20px; }
        .nav-button { display: inline-block; padding: 12px 25px; background: #2c3e50; color: #fff; text-decoration: none; border-radius: 6px; font-weight: bold; }
        .nav-button.master { background: #e67e22; }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mesa-title">Carregando Mesa...</h1>
        <div class="personagens-grid" id="personagens-container">
            </div>
        <div class="navigation-links">
            <a href="/" class="nav-button">Voltar para Mesas</a>
            <a id="master-panel-link" href="#" class="nav-button master">Escudo do Mestre</a>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const mesaId = params.get('mesa');

        if (!mesaId) {
            document.body.innerHTML = '<h1>Mesa não encontrada. Verifique o link.</h1>';
        } else {
            document.title = `Lobby - ${mesaId}`;
            document.getElementById('mesa-title').innerText = `Mesa: ${mesaId}`;
            document.getElementById('master-panel-link').href = `/controle.html?mesa=${mesaId}`;
            
            const socket = io({ query: { mesaId } });
            const container = document.getElementById('personagens-container');

            socket.on('init', (personagens) => {
                container.innerHTML = '';
                if (Object.keys(personagens).length === 0) {
                    container.innerHTML = '<p>Ainda não há personagens nesta mesa.</p>';
                } else {
                    for (const id in personagens) {
                        const p = personagens[id];
                        const card = document.createElement('div');
                        card.className = 'personagem-card';
                        card.innerHTML = `
                            <img src="${p.imagem || '/images/portrait.png'}" class="portrait">
                            <h3>${id}</h3>
                            <a href="/ficha.html?mesa=${mesaId}&personagem=${encodeURIComponent(id)}" target="_blank">Abrir Ficha</a>
                        `;
                        container.appendChild(card);
                    }
                }
            });

            socket.on('connect', () => console.log('[LOBBY] Conectado ao servidor.'));
        }
    </script>
</body>
</html>